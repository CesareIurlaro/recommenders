{
   "_id": "_design/objectUsages",
   "language": "javascript",
   "views": {
       "byFingerprint": {
           "map": "function(doc) {\n\t\t\t\t\n\tvar NO_METHOD = \"LNone.none()V\"\n\tvar UNKNOWN_METHOD = \"LNull.null()V\"\n\n\tif(!doc.imports || !doc.primaryType)\n\t\treturn;\n\n\tvar type2fingerprint = new Object();\n\tfor(var i=0; i<doc.imports.length; i++) {\n\t\tvar _import = doc.imports[i];\n\t\ttype2fingerprint[_import.name] = _import.fingerprint;\n\t}\n\n\tfor(var i=0; i<doc.primaryType.methods.length; i++) {\n\t\tvar method = doc.primaryType.methods[i];\n\t\tfor(var j=0; j<method.objects.length; j++) {\n\t\t\tvar object = method.objects[j];\n\t\t\tvar fingerprint = type2fingerprint[object.type];\n\t\t\tif(fingerprint != null && fingerprint != \"\") {\n\t\t\t\tvar objectUsage = {\n\t\t\t\t\t\"type\" : object.type,\n\t\t\t\t\t\"contextFirst\" : secondIfNull(method.firstDeclaration, UNKNOWN_METHOD),\n\t\t\t\t\t\"contextSuper\" : secondIfNull(method.superDeclaration, UNKNOWN_METHOD),\n\t\t\t\t\t\"calls\" : [],\n\t\t\t\t}\n\n\t\t\t\tvar initCall = null\n\t\t\t\tfor(k in object.receiverCallSites) {\n\t\t\t\t\tvar call = object.receiverCallSites[k].targetMethod\n\t\t\t\t\tvar isInit = call.indexOf(\"<init>\") != -1\n\t\t\t\t\tif(isInit) {\n\t\t\t\t\t\tinitCall = call\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobjectUsage.calls.push(call);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar kind = null;\n\t\t\t\tvar definition = null;\n\t\t\t\t\n\t\t\t\tif(object.definitionSite != null) {\n\t\t\t\t\tkind = object.definitionSite.kind\n\t\t\t\t\tdefinition = object.definitionSite.definedByMethod\n\t\n\t\t\t\t\tif(kind==\"PARAMETER\" || kind==\"FIELD\") {\n\t\t\t\t\t\tdefinition = NO_METHOD\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\tif(kind == null) {\n\t\t\t\t\tkind = \"UNKNOWN\"\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\tif(initCall != null) {\n\t\t\t\t\tkind = \"NEW\"\n\t\t\t\t\tdefinition = initCall\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(definition == null) {\n\t\t\t\t\tdefinition = UNKNOWN_METHOD\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tobjectUsage.kind = kind\n\t\t\t\tobjectUsage.definition = definition\n\n\t\t\t\tif(objectUsage.calls.length > 0) {\n\t\t\t\t\temit(fingerprint, objectUsage);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// -------------------------------------------\t\n\t\t\n\tfunction secondIfNull(first, second) {\n\t\tif(first == null)\n\t\t\treturn second\n\t\telse\n\t\t\treturn first\n\t}\n\n}",
           "reduce": "function (key, values, rereduce) {\n\tif(rereduce)\n\t\treturn sum(values);\n\telse\n\t\treturn values.length;\n}"
       },
       "latestTimestampByFingerprint": {
           "map": "function(doc) {\n\tif(!doc.imports || !doc.primaryType)\n\t\treturn;\n\n\tfor(var i=0; i<doc.imports.length; i++) {\n\t\tvar _import = doc.imports[i];\n\t\tif(_import.fingerprint) {\n\t\t\temit(_import.fingerprint, doc.creationTimestamp);\n\t\t}\n\t}\n}",
           "reduce": "function (key, values, rereduce) {\n\tif(values.length > 0) {\n\t\tvalues = values.sort();\n\t\treturn values[values.length-1];\n\t}\n\telse\n\t\treturn values;\n}"
       }
   }
}